<html lang="en">

    <head>
    <meta charset="utf-8">

    <title>Your Accounts</title>

    </head>

    <body style="padding: 10%">
        <h1>Your Accounts</h1>
        <hr>
        <div id="balances"></div>
    </body>

    <script>
        "use strict";
        var xhttp = new XMLHttpRequest();
        xhttp.onreadystatechange = function() {
            if (this.readyState == 4 && this.status == 200) {
                accountBalances(this);
            }
        };
        xhttp.open("GET", "/accountdata", true);
        xhttp.send();
        
        function accountBalances(xml) {
            "use strict";
            let xmlDoc = xml.responseXML;

            //console.log(xmlDoc);
            
            let tags = xmlDoc.getElementsByTagName('*');
            for (let i = 1; i < tags.length; (i+=3)) {

                let node = document.createElement("div");

                node.innerHTML += "<h2>" + tags[i].firstChild.nodeValue + "</h2>"; 
                node.innerHTML += "<br><strong>Balance: </strong>" + tags[i+2].firstChild.nodeValue + "<br><br>";
                document.getElementById("balances").appendChild(node);
                
                let withdrawFormNode = document.createElement("form");
                withdrawFormNode.action = "javascript:sendWithdrawXML("+tags[i+1].firstChild.nodeValue+");";
                withdrawFormNode.innerHTML += '<input type="number" min="0.00" step="0.01" name="withdrawAmount" id="withdrawValue' + tags[i+1].firstChild.nodeValue + '">';
                withdrawFormNode.innerHTML += '<input type="submit" value="Withdraw">';
                document.getElementById("balances").appendChild(withdrawFormNode);

                let depositFormNode = document.createElement("form");
                depositFormNode.action = "javascript:sendDepositXML("+tags[i+1].firstChild.nodeValue+");";
                depositFormNode.innerHTML += '<input type="number" min="0.00" step="0.01" name="depositAmount" id="depositValue' + tags[i+1].firstChild.nodeValue + '">';
                depositFormNode.innerHTML += '<input type="submit" value="Deposit"><br><br><hr>';
                document.getElementById("balances").appendChild(depositFormNode);
            }
        }

        function sendWithdrawXML(i) {
            "use strict";
            //console.log(document.getElementById('withdrawValue'+i).value);
            let withdrawString = "<withdraw><accountid>" + i + "</accountid>";
            withdrawString += "<amount>" + document.getElementById('withdrawValue'+i).value + "</amount></withdraw>";

            let parser = new DOMParser();
            let xmlDoc = parser.parseFromString(withdrawString ,"text/xml");

            // console.log(withdrawString);
            // console.log(xmlDoc);
            
            let xhttp2 = new XMLHttpRequest();
            xhttp2.onreadystatechange = function() {
            if (this.readyState == 4 && this.status == 200) {
                    balanceChange();
                }
            };

            xhttp2.open("POST", "/withdraw", true);
            xhttp2.send(xmlDoc);
        }

        function sendDepositXML(i) {
            "use strict";
            //console.log(document.getElementById('depositValue'+i).value);
            

            
        }

        function balanceChange() {

        }
    </script>

</html>